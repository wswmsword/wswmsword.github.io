<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  <meta name="referrer" content="unsafe-url">
  
  <title>近一年的工作</title>
  <meta name="author" content="wsWmsword">
  <meta name="description" content="Pain is temporary Pride is forever">
  
  
  <meta property="og:title" content="近一年的工作"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="Strawberry Fields"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="Strawberry Fields" type="application/atom+xml">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="main-ctnr">
      <div class="behind">
  <a href="/" class="back black-color">
    <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
        <path d="M2 30 L30 2 M30 30 L2 2"></path>
    </svg>
  </a>
  
    <div class="description">
      &nbsp;郁郁青青 长过千寻
    </div>
    
</div>


  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        近一年的工作
    </h1>
  


    </div>
    <div class="meta center">
      <time datetime="2024-05-05T04:07:02.000Z" itemprop="datePublished">
  <svg class="i-calendar" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2024-05-05
</time>





    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/tags/笔记本/">笔记本</a>


    </div>
    <hr>
    
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">网站性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E7%9A%84-SEO-%E4%BC%98%E5%8C%96"><span class="toc-text">网站的 SEO 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E7%9A%84%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C"><span class="toc-text">网站的用户体验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%88%87%E6%8D%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="toc-text">页面切换进度条</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E7%82%B9%E5%A4%8D%E6%9D%82%E7%9A%84%E6%8C%89%E9%92%AE"><span class="toc-text">有点复杂的按钮</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E7%9A%84%E5%88%9B%E6%84%8F%E8%A1%A8%E8%BE%BE"><span class="toc-text">网站的创意表达</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%8C%E6%9C%89%E7%A7%91%E6%8A%80%E6%84%9F%E7%9A%84%E6%8C%89%E9%92%AE"><span class="toc-text">富有科技感的按钮</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BD%93%E6%84%9F%E5%BC%BA%E7%9A%84%E5%AF%BC%E8%88%AA%E6%A0%8F%E8%8F%9C%E5%8D%95"><span class="toc-text">一体感强的导航栏菜单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5"><span class="toc-text">相关链接</span></a></li></ol>
    
    <div class="picture-container">
      
    </div>
    <p>从成都到上海，现在就快要工作一年，又要离开了。一份工作里有伤感、有快乐，虽然这一年的工作是一条泥路，走得艰难，好在这条路上找到了宝藏，我结识了几个朋友，储备了一些钱，翻新了一身装备，找到了稳定腰突症状的方法，见证了几段婚姻的开始，结束了漂泊动荡的一段时间。</p>
<p>回想成都的时光，满是不舍，遗憾没有足够的时间感受这座美丽的城市。这次回到上海，有时候当我走过熟悉的小路时，我会突然停下脚步，就感受到了周围陌生的树木和楼房，可能匆忙的人带走的是路上的味道、声音、行人的身影和那条习惯性的路线，回忆的时候很难有一副固定的图画，所以这一次，我总是会在一个地方停下来，成为生活在这里的人，在去往的人流中，用力去触碰前面的叶片和砖墙。</p>
<p><img src="black-bird.jpg" alt="Black Swans in the Work Park"></p>
<p>下面会分享一些我在这份工作里做的事情。</p>
<h2 id="网站性能优化"><a href="#网站性能优化" class="headerlink" title="网站性能优化"></a>网站性能优化</h2><p>这一份工作里着手做了性能优化的工作，优化之后，网站从 SSR 迁移到了 SSG，首页产包从原先的 2.5Mb 缩小至 1.8Mb，PageSpeed Insights（PSI）上的 Core Web Vitals 性能得分从最初的 30 分稳定到了 60 分以上。</p>
<p>主要做了下面这些工作：</p>
<ul>
<li>渲染方式从 SSR 向 SSG 迁移；</li>
<li>全路径导入依赖，缩小产包，避免 <code>export *</code> 导致的摇树失效；</li>
<li>延迟统计、日志脚本的加载，延迟加载 IM iframe；</li>
<li>固定图片的宽高，固定图片的比例，避免布局抖动；</li>
<li>将图片的尺寸缩放成适当大小，并且缩小图片体积；</li>
<li>图片、视频等资源的懒加载；</li>
<li>移除导航栏大量链接的 prefetch；</li>
<li>同步线性的多个请求修改为异步的 allSettled 请求；</li>
<li>移除未使用的依赖。</li>
</ul>
<p>这里面每一项都可以作为日常开发的标配，但是也依赖项目的维护程度，没有定期维护的项目，不同的问题会交织堆叠，优化起来则需要更多的时间。</p>
<p>在我优化的官网项目里，SSG 的迁移不仅要替换 <code>getStaticProps</code>，还要做一点副业。原本为了方便 SEO 运营人员能够及时修改和更新每个页面的 <code>title</code>、<code>description</code> 等对 SEO 有利的数据，代码里通过 SSR 在每次请求页面的时候，同步执行接口来获取最新的 SEO 数据。所以，要迁移至 SSG，也要确保 SEO 数据能被及时更新。最后，我添加了页面增量静态生成 ISR 的支持，它会在更新完 SEO 数据后请求一个 API，next 服务接收到请求后，会对需要更新 SEO 数据的页面重新生成最新的静态页面。</p>
<p>SSG 的迁移加速了首屏加载，为了更快，我开始优化产包。综合 PSI、开发者工具的 Coverage 面板和产包分析工具 <code>@next/bundle-analyzer</code> 提供的线索，PSI 会提示某个文件执行耗时过长，Coverage 面板会列出未执行代码最多的文件，以及产包分析工具会可视化地辅助查看具体是某个包被引用在某个页面，最终我把优化目标锁定在 <code>_app.js</code> 中。</p>
<p>面对 <code>_app.js</code> 引入的很多组件和函数，从外到内，先注释所有的依赖，然后逐个解开，改动一次做一次产包分析，就像增减砝码一样，找到占体积最大、范围最小、最适合优化的一部分，最后对这部分进行无效依赖的删除、使用全路径导入依赖。最终，产包缩小了约 700Kb，虽然成果不算理想，但是最后一个水桶产包已经暴露无遗——一个占领 1Mb 空间的登录按钮组件，这个组件有盘根错节的依赖、复杂的业务逻辑和潜伏着的各种小问题，时间有限，只好先放手了，来日方长，有缘再优化。</p>
<h2 id="网站的-SEO-优化"><a href="#网站的-SEO-优化" class="headerlink" title="网站的 SEO 优化"></a>网站的 SEO 优化</h2><p>这是我首次实践 SEO 的优化，和之前的工作不同，内部管理平台、小程序或 Hybrid H5 都不需要关注 SEO，这一次做的是海外官网，需要通过 SEO 提高搜索曝光度。</p>
<p>主要做了下面这些事情：</p>
<ul>
<li>生成结构化路径，展示面包屑组件；</li>
<li>由接口管理的 title 和 description 配合 SSG 做增量静态生成；</li>
<li>使用 canonical <code>&lt;link&gt;</code> 标签规范网址，避免用于统计的 query string 被单独收录，例如避免 <code>https://official.com?code=abc</code> 被收录；</li>
<li>规范并生成多语言的 sitemap，为 sitemap 排除 noindex、301 页面；</li>
<li>为每个页面的多语言添加 alternate <code>&lt;link&gt;</code> 标签；</li>
<li>对禁止抓取的网址添加 noindex <code>&lt;meta&gt;</code> 标签或响应 noindex 头；</li>
<li>为图片添加 <code>alt</code> 属性、规范页面标题结构；</li>
<li>规范页面路径，启用硬 404，对旧路径实行 301 跳转；</li>
<li>点击事件跳转页面替换为 <code>&lt;a&gt;</code> 标签，增加内链数量；</li>
<li>性能优化。</li>
</ul>
<p>关于面包屑组件，在我的实现里，引入这个组件会做两件事情，第一，借助 Nextjs 可以在任意位置放置 <code>&lt;Head&gt;</code> 标签的特性，生成<code>application/ld+json</code> 类型的 <code>&lt;script&gt;</code> 标签结构化路径，第二，负责 UI 层面的面包屑展示。</p>
<p>关于对旧路径实行 301 跳转。在这个项目里，博客页面来自 Wordpress，首先在 next 服务里请求 Wordpress 页面，获取 Wordpress 页面的 HTML 内容字符串后，再把它返回给客户端，所以，如果 Wordpress 页面执行了 301 中转，只会体现在 next 服务中，而客户端不能识别，客户端的 url 将不会改变。我使用的方法是利用 HTTP 的 HEAD 方法，只获取 301 和目标 url，然后返回客户端，最后客户端会自动跳转到对应的 url。</p>
<p>在实践上面这些技术上的 SEO 优化时，意外发现了一种规范图片 alt 的好方法——SEO 运营人员向开发者提供的一张 SEO 表格，这张表格包含一个页面所有的 SEO 信息，包括页面里每一张图片和图片对应的 alt 文本。有了这张表格，图片的 alt 被纳入到 SEO 的范围，图片的 alt 属性终于可以不被忽略了。</p>
<h2 id="网站的用户体验"><a href="#网站的用户体验" class="headerlink" title="网站的用户体验"></a>网站的用户体验</h2><p>好的用户体验让产品脱颖而出。MacBook 的磁吸式充电接口不仅容易插拔、让笔记本更便携，也能防止拖拽摔落；楼梯两边的平滑坡道方便了携带旅行箱的人们；有抽绳的裤子，绳口之间存在镂空让绳端交叉穿出，相比没有镂空，能够省去一次打结的功夫。</p>
<p><img src="drawstring-pants.jpg" alt="Drawstring Pants"></p>
<p>每一个组件就像一个产品，细节分布在每个组件里，好的用户体验，组成一个让用户体验如蜜的网站。</p>
<h3 id="页面切换进度条"><a href="#页面切换进度条" class="headerlink" title="页面切换进度条"></a>页面切换进度条</h3><p>当网站变成单页面应用 SPA 之后，有了类似软件的原生体验、更细粒度的路由，却丢失了浏览器左上角的刷新动画。如果新页面很重、网络环境很差，最后用户只能带着失望的心情离开我们的网站。</p>
<p>给网站添加页面切换进度条之后，效果就像下面这样，虽然这个进度条没有真实地表达进度百分比，但是它已经起到了和浏览器左上角刷新按钮同样的提示作用，用户会怀着期待的心情走进新的页面。</p>
<p><img src="page-progress.gif" alt="Page routing progress bar"></p>
<h3 id="有点复杂的按钮"><a href="#有点复杂的按钮" class="headerlink" title="有点复杂的按钮"></a>有点复杂的按钮</h3><p>上一个例子是视觉上的用户体验的提升，这个例子会解释正确、规范的编码，会如何提升用户体验。</p>
<p>编码时，按钮是个经常会被用错的控件，正因为它的常用，错误的使用更容易破坏网站的用户体验，例如使用按钮实现一个链接，又或者使用 <code>&lt;div&gt;</code> 标签当成点击事件的监听元素，模拟一个按钮，这些 <code>&lt;div&gt;</code> 标签按钮却没有模拟按钮的其它特性：</p>
<ul>
<li>设置 ARIA 的 <code>button</code> 角色及其它相关 ARIA 属性，以便被屏幕阅读器识别；</li>
<li>监听键盘按下空格和回车的事件；</li>
<li>按钮 <code>disabled</code> 状态下的不可触发样式；</li>
<li>按钮被聚焦，以及鼠标 <code>hover</code> 时的样式；</li>
<li>按钮按下空格时的样式；</li>
<li>为 <code>&lt;div&gt;</code> 标签添加 <code>tabindex</code> 属性。</li>
</ul>
<p>这些特性让按钮这个 Web 控件和操作系统的原生按钮有一致或类似的体验，组成了用户体验，可以防止用户对控件产生陌生感。从这些特性看，自制一个按钮是复杂的，这也是推荐使用原生 <code>&lt;button&gt;</code> 标签的原因。</p>
<p>使用 <code>&lt;button&gt;</code> 标签有可能产生新的顾虑，是因为之所以使用 <code>&lt;div&gt;</code> 按钮，是希望监听一个复杂布局的点击事件，而按钮通常包裹的是简单的短文本，例如“提交”按钮和“删除”按钮。实际上，<code>&lt;button&gt;</code> 标签对子元素的确有一些限制，这些限制却不是布局的限制，而是子元素标签种类的限制，子元素只允许是短语内容（Phrasing content），例如子元素可以是 <code>&lt;span&gt;</code>，不可以是 <code>&lt;div&gt;</code>，因此我们可以按照规范，使用 <code>&lt;span&gt;</code> 结合 CSS 开发复杂布局的按钮。</p>
<p>复杂的按钮就像下面这样，它能够被点击、能够通过键盘访问、触发后有样式反馈、同时也有复杂的布局，这样的按钮既有好的用户体验，满足了用户预期，因为他有宽大的布局，也能够吸引用户触发，符合了产品的预期，最后，这样的代码也更容易维护，这是因为 <code>&lt;button&gt;</code> 标签是有语义的，看见了它就清楚它一定包含事件函数。</p>
<p><img src="complex-button.gif" alt="Somewhat complicated buttons"></p>
<h2 id="网站的创意表达"><a href="#网站的创意表达" class="headerlink" title="网站的创意表达"></a>网站的创意表达</h2><blockquote>
<p>我在社会中所扮演的角色，或者任何艺术家或诗人的角色，就是尝试将我们感受到的一切表达出来。不是去告诉人们如何感受，不是作为一名传道士，不是作为一名领导者，而是作为对我们所有人的某种反应。</p>
<p>——《约翰·列侬——在他生命中》，p6</p>
</blockquote>
<p>作为父亲，约翰把对儿子的话写成了歌曲《Beatiful Boy》，作为丈夫，约翰为了平复和妻子的矛盾，写下了歌曲《Aisumasen (I’m Sorry)》，作为孩子，从小失去家庭的约翰，写下了歌曲《Mother》。所以，“世界很大，你要说话。”</p>
<p>编码也如此，需要表达，而不是沉浸在优雅的代码规范中跳舞，对于前端，它和用户面对面，因此它的反馈最快，所需的表达欲也最强烈。</p>
<h3 id="富有科技感的按钮"><a href="#富有科技感的按钮" class="headerlink" title="富有科技感的按钮"></a>富有科技感的按钮</h3><p>这是一个放在首页顶部轮播图的、醒目的按钮，当我思考如何体现科技感时，我点开了触发按钮后打开的视频，看到了视频开头的点阵，我找到了灵感，我让移动的点阵在鼠标悬浮或是按钮被聚焦的时候显现出来，下面是最终的效果。</p>
<p><img src="tech-btn.gif" alt="Technonlogy rich button"></p>
<h3 id="一体感强的导航栏菜单"><a href="#一体感强的导航栏菜单" class="headerlink" title="一体感强的导航栏菜单"></a>一体感强的导航栏菜单</h3><p>最近越来越多的导航栏开始用一种有“一体感”的方式展现内容，例如苹果官网的导航栏，打开不同的菜单，菜单的面板没有收回，而是改变面板的高度，再替换面板的内容。这样的切换方式会让用户有流畅的感觉，所以我也对官网的导航栏做了类似得效果实现，我保留了菜单面板高度变化的效果，不一样的是，在面板切换时，我让内容根据切换的方向进行入场和退场，下一个菜单会把上一个菜单推向背后，用这样的方式增强一体感。最后，菜单面板就像一个履带，切换轨道、前后输送。</p>
<p><img src="unity-sense-menu.gif" alt="Navigator menu with a strong sense of unity"></p>
<p>这样工作才有趣，因为我在实现我想表达的事物，产品在向用户表达它想表达的事物，这也是小团队的一点优势，每个人都会发挥一些创造力。</p>
<blockquote>
<p>The show must go on.</p>
</blockquote>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li>短语内容（Phrasing content），<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Content_categories#phrasing_content"><em>https://developer.mozilla.org/en-US/docs/Web/HTML/Content_categories#phrasing_content</em></a></li>
<li>ARIA Buttons，自制按钮，<a target="_blank" rel="noopener" href="https://github.com/scottaohara/aria_buttons/tree/main"><em>‌https://github.com/scottaohara/aria_buttons/tree/main</em></a></li>
<li>基于 Web Vitals 的前端性能优化实践，<a target="_blank" rel="noopener" href="https://keenwon.com/web-vitals/#473-%E6%A0%B8%E5%BF%83%E8%BF%98%E6%98%AF%E9%99%8D%E4%BD%8E-js-%E4%BD%93%E7%A7%AF"><em>https://keenwon.com/web-vitals/#473-%E6%A0%B8%E5%BF%83%E8%BF%98%E6%98%AF%E9%99%8D%E4%BD%8E-js-%E4%BD%93%E7%A7%AF</em></a></li>
<li>搜索引擎优化 (SEO) 入门指南，<a target="_blank" rel="noopener" href="https://developers.google.com/search/docs/fundamentals/seo-starter-guide?hl=zh-cn"><em>https://developers.google.com/search/docs/fundamentals/seo-starter-guide?hl=zh-cn</em></a></li>
</ul>


  </article>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <div class="busuanzi center">
    页阅读量:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    站访问量:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    站访客数:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>


    





    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        © chen 2016-2021
    </div>
    <div class="secondrow">
        <a target="_blank" rel="noopener" href="https://www.poinotes.com/">
        Signal
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
