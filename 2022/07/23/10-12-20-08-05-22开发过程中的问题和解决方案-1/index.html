<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  <meta name="referrer" content="unsafe-url">
  
  <title>10/12/20-08/05/22开发过程中的问题和解决方案</title>
  <meta name="author" content="wsWmsword">
  <meta name="description" content="Pain is temporary Pride is forever">
  
  
  <meta property="og:title" content="10/12/20-08/05/22开发过程中的问题和解决方案"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="Strawberry Fields"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="Strawberry Fields" type="application/atom+xml">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="main-ctnr">
      <div class="behind">
  <a href="/" class="back black-color">
    <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
        <path d="M2 30 L30 2 M30 30 L2 2"></path>
    </svg>
  </a>
  
    <div class="description">
      &nbsp;郁郁青青 长过千寻
    </div>
    
</div>


  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        10/12/20-08/05/22开发过程中的问题和解决方案
    </h1>
  


    </div>
    <div class="meta center">
      <time datetime="2022-07-23T15:22:16.000Z" itemprop="datePublished">
  <svg class="i-calendar" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2022-07-23
</time>


    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/categories/笔记本/">笔记本</a>





    </div>
    <hr>
    
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88-uniapp-%E9%A1%B9%E7%9B%AE%E5%92%8C%E8%BF%9C%E7%A8%8B%E8%B5%84%E6%BA%90"><span class="toc-text">整合 uniapp 项目和远程资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%8B%E7%82%B9"><span class="toc-text">埋点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E5%9F%8B%E7%82%B9%E5%86%85%E5%AE%B9%E5%92%8C%E9%A1%B5%E9%9D%A2%E9%80%BB%E8%BE%91"><span class="toc-text">分离埋点内容和页面逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E5%9F%8B%E7%82%B9%E8%AF%B7%E6%B1%82%E4%B8%8D%E9%98%BB%E7%A2%8D%E4%B8%9A%E5%8A%A1%E8%AF%B7%E6%B1%82"><span class="toc-text">延迟埋点请求不阻碍业务请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%87%8C%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%BC%E8%88%AA%E6%A0%8F"><span class="toc-text">小程序里的自定义导航栏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%9A%84%E9%85%8D%E7%BD%AE%E8%B7%B3%E8%BD%AC"><span class="toc-text">后台的配置跳转</span></a></li></ol></li></ol>
    
    <div class="picture-container">
      
    </div>
    <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="整合-uniapp-项目和远程资源"><a href="#整合-uniapp-项目和远程资源" class="headerlink" title="整合 uniapp 项目和远程资源"></a>整合 uniapp 项目和远程资源</h2><p>问题:</p>
<p>（uniapp）开发小程序时，小程序有<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages.html">体积限制</a>，例如微信小程序的体积不能超过 20M，所以如果项目中需要使用许多静态资源，静态资源就不能放在小程序的产包中，必须放在存储静态资源的服务器中。可是，放在服务器中的资源不能体现在小程序项目结构里，代码只会硬编码引用这些资源的链接。如果队友误删了服务器中某个资源，代码里引用的该链接将失效，也不能复原；如果删除了代码里的引用链接，又忘了删除服务器资源，会让服务器资源冗余。所以需要一种方法来跟踪资源的变化，同步引用链接和服务器资源。</p>
<p>方案:</p>
<p>资源放在项目结构中，并且同步至服务器。在代码里，设置一个路径前缀，用于引用资源。在项目的打包阶段，检测产包的环境，如果产包用于生产环境，替换路径前缀为资源在服务器上的路径；如果产包用于开发环境（热重载环境），替换路径前缀为资源在本地项目中的路径。</p>
<p>解释：</p>
<p>同步本地资源和远程资源是为了 git 管理，为了可以跟踪文件变化，为了可以在远程资源被误删的时候还能从本地资源复制到服务器，达到还原的效果。</p>
<p>同步最简单的方法是，在需要添加资源的时候，把资源复制到项目里用于 git 管理，再把资源复制到服务器用于引用。当远程资源被误删的时候，就可以把本地 git 管理的所有资源完整复制到服务器。</p>
<p>但是在实际操作的时候这样执行还会遇到一个问题，不能保证不会在把资源传输到服务器之后忘记把资源同时也复制到项目中。这是因为</p>
<ul>
<li>代码中实际引用的是远程资源，而本地项目资源只用于 git 管理，没有其它作用；</li>
<li>同步是人工的，如果要同步到 10 个服务器，很可能在同步的时候遗漏；</li>
<li>如果每次先上传远程资源，开发进度紧张，虽然遗漏了本地资源，但开发预览的时候还是正常，会造成更容易忽略复制本地资源的步骤。</li>
</ul>
<p>这里通过让本地资源被运用到开发过程里的一环来解决上面的问题。</p>
<p>开发过程可以被分成“开发环境”和“生成环境”，生产环境定义为测试、验收和上线的环境，开发环境定义为正在本地开发时的环境。回到上面的问题，项目里需要引用资源，而在开发环境可以不依赖服务器上的资源，也就是可以不引用远程资源，因此可以在本地开发的时候，引用本地资源，在生产环境的时候，引用远程资源。</p>
<p>这样在开发环境顺利开发完成后，从开发环境切换到生成环境，如果服务器上没有和本地项目里对应的资源，生产环境的产包就不能正确加载资源，所以这时一定会把本地项目里的资源同步复制到服务器中。这就解决了两次复制造成冗余的问题。</p>
<p>这其中相比最简单的方法有两个变化：</p>
<ul>
<li>测试环境使用本地资源进行引用；</li>
<li>强制首先复制到项目本地资源，最后统一同步复制到远程服务器。</li>
</ul>
<p>至于怎样在开发的时候引用本地，在生产的时候引用服务器，一定不是全局手动替换，例如把所有“<code>/assets/logo.png</code>”替换为“<code>https://demo.com/assets/logo.png</code>”。可以利用代码打包工具，例如在打包阶段，设置遇到了“<code>%img-path/</code>”就根据当前的环境进行替换，如果是开发环境，就把“<code>%img-path/assets/logo.png</code>”替换为“/assets/logo.png”，如果是生产环境，就把“<code>%img-path/assets/logo.png</code>”替换为“<code>https://demo.com/assets/logo.png</code>”。</p>
<h2 id="埋点"><a href="#埋点" class="headerlink" title="埋点"></a>埋点</h2><h3 id="分离埋点内容和页面逻辑"><a href="#分离埋点内容和页面逻辑" class="headerlink" title="分离埋点内容和页面逻辑"></a>分离埋点内容和页面逻辑</h3><p>问题：</p>
<p>埋点内容和页面逻辑无关，直接添加在逻辑代码的首行或者末行会让代码更混乱。</p>
<p>方案：</p>
<p>埋点内容单独放在埋点文件中管理，在逻辑中进行埋点的时候，只传递必要的变量。</p>
<p><a href="https://wswmsword.github.io/2022/06/18/%E6%95%B0%E6%8D%AE%E5%9F%8B%E7%82%B9%EF%BC%88%E4%BA%8C%EF%BC%89/">数据埋点（二）</a></p>
<p><a href="./%E6%95%B0%E6%8D%AE%E5%9F%8B%E7%82%B9%EF%BC%88%E4%BA%8C%EF%BC%89.md">数据埋点（二）</a></p>
<h3 id="延迟埋点请求不阻碍业务请求"><a href="#延迟埋点请求不阻碍业务请求" class="headerlink" title="延迟埋点请求不阻碍业务请求"></a>延迟埋点请求不阻碍业务请求</h3><h2 id="小程序里的自定义导航栏"><a href="#小程序里的自定义导航栏" class="headerlink" title="小程序里的自定义导航栏"></a>小程序里的自定义导航栏</h2><h2 id="后台的配置跳转"><a href="#后台的配置跳转" class="headerlink" title="后台的配置跳转"></a>后台的配置跳转</h2>

  </article>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <div class="busuanzi center">
    页阅读量:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    站访问量:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    站访客数:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>


    





    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        © chen 2016-2021
    </div>
    <div class="secondrow">
        <a target="_blank" rel="noopener" href="https://www.poinotes.com/">
        Signal
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
