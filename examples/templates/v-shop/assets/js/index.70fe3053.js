import{_ as D}from"./index.332e104b.js";import{_ as E}from"./index.vue_vue_type_script_setup_true_lang.dbef4dbf.js";import{e as y,a7 as P,K as k,k as m,r as v,o as b,f as q,w as U,$ as z,j as L,i as e,y as M,h,z as _,a as N,b as u,g as d,l as f,G as j,H as G}from"./vendor.1aafb642.js";import{r as H,_ as C,u as K,A as W}from"./index.ce6ac14e.js";import{c as g}from"./validate.1a81b3ef.js";import{a as J}from"./index.4d464653.js";import"./is.697638d0.js";function Q(a,c,l={}){const s={type:a.type,...l};return new File([a],c,s)}function X(a){return H({url:"/dfs/upload/file",method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}})}const Y={dfsUploadFile:X},Z=y({name:"UploadAvatar",emits:["success","error"],setup(a,{emit:c}){function l(n){return new Promise(r=>{new P(n,{quality:.8,maxWidth:1024,success:async o=>{const t=Q(o,n.name);r(t)},error:o=>{console.error("[Compressor error]",o),c("error",o)}})})}async function s(n){const r=n.file,o=new FormData;o.append("upfile",r),k({forbidClick:!0,message:"上传中...",duration:0}),Y.dfsUploadFile(o).then(t=>{m(),c("success",t)}).catch(t=>{console.error(t),m(),c("error",t)})}return{beforeRead:l,afterRead:s}}});function O(a,c,l,s,n,r){const o=v("van-uploader");return b(),q(o,{"before-read":a.beforeRead,"after-read":a.afterRead},{default:U(()=>[z(a.$slots,"default")]),_:3},8,["before-read","after-read"])}const ee=C(Z,[["render",O]]),S=a=>(j("data-v-e57e71d9"),a=a(),G(),a),oe={class:"container"},ae={class:"header"},te={class:"avatar"},se=S(()=>u("div",{class:"avatar-title"},"点击更换头像",-1)),ne={class:"main"},re={class:"nick"},ce=S(()=>u("div",{class:"nick-label"},"昵称",-1)),ie=y({__name:"index",setup(a){L(()=>{n.value=e(s).avatarUrl??"",r.value=e(s).nick??"",o.value=e(s).province??"",t.value=e(s).city??""});const c=M(),l=K(),s=h(()=>l.getUserInfo),n=_(""),r=_(""),o=_(""),t=_(""),$=h(()=>e(o)?e(o)===e(t)?e(t):`${e(o)} - ${e(t)}`:"");function x(i){n.value=i.data.url}function F({selectedOptions:i}){o.value=i[0].text,t.value=i[1].text}function w(){if(e(n)===e(s).avatarUrl&&e(r)===e(s).nick&&e(o)===e(s).province&&e(t)===e(s).city){f("您没有修改任何东西哦");return}if(g(e(r))){f("昵称不能为空");return}if(g(e(o))){f("所在地不能为空");return}const i={nick:e(r),avatarUrl:e(n),province:e(o),city:e(t)};k({forbidClick:!0,message:"提交中...",duration:0}),W.userModify(i).then(()=>{m(),f("资料修改成功"),c.back()}).catch(p=>{console.error(p)})}return(i,p)=>{const A=v("van-image"),I=ee,B=v("van-field"),R=E,T=D;return b(),N("div",oe,[u("div",ae,[d(I,{onSuccess:x},{default:U(()=>[u("div",te,[d(A,{class:"avatar-img",src:n.value||e(J).avatar},null,8,["src"]),se])]),_:1})]),u("div",ne,[u("div",re,[ce,d(B,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=V=>r.value=V),placeholder:"12个字以内"},null,8,["modelValue"])]),d(R,{"model-value":$.value,label:"所在地",placeholder:"点击选择城市","input-align":"right",border:!1,"columns-num":2,onChange:F},null,8,["model-value"])]),d(T,{size:"medium",onClickBtn:w})])}}});const ve=C(ie,[["__scopeId","data-v-e57e71d9"]]);export{ve as default};
