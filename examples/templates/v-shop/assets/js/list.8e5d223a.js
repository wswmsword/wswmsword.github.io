import{_ as U}from"./index.48a12f4a.js";import{e as z,y as j,r as O,o as i,a as f,b as o,D as m,V as Q,g as h,C as v,i as p,f as S,w as l,E as C,P as I,F as D,l as V,u as G,j as H,z as x,A as R,B as w}from"./vendor.1aafb642.js";import{A as J}from"./index.a51135f2.js";import{d as K}from"./format.df5cff0c.js";import{P as W}from"./index.6be6f4f2.js";import{u as X}from"./order.1a54acc5.js";import{_ as B}from"./index.ce6ac14e.js";import"./index.6012130b.js";import"./is.697638d0.js";function Y(t,N){const _=[];return t.forEach(r=>{const c=N[r.id]||[];_.push({...r,goodsInfo:c.length?c[0]:{}})}),_}const Z={class:"list-item"},tt={class:"list-item-header van-hairline--bottom"},et={class:"list-item-header-hd"},st={class:"title"},ot={key:0,class:"good-card"},nt={class:"good-card-content"},it={class:"good-card-content-hd"},at={class:"good-card-title"},rt={key:0,class:"good-card-prop"},dt={class:"good-card-content-bd"},lt={class:"good-card-price"},ct={class:"good-card-number"},ut={key:1,class:"list-item-more"},mt={class:"list-item-total van-hairline--top"},vt={class:"list-item-total-number"},ft={class:"list-item-total-price"},_t={class:"list-item-total-price-label"},gt={class:"list-item-footer van-hairline--top"},ht=z({__name:"OrderItem",props:{item:{type:Object,default:()=>{}},index:{type:Number,default:0}},emits:["delete"],setup(t,{emit:N}){const _=j(),r=X();function c(n){const{orderNumber:e}=n;_.push({path:"/order/detail",query:{orderNumber:e}})}function y(n){V("未开放：客服")}function $(n){r.closeOrder({orderId:n.id}).then(()=>{V({message:"取消订单成功",duration:1500}),n.status=-1,n.statusStr="订单关闭"}).catch(e=>{console.error(e)})}function k(n,e){r.deleteOrder({orderId:n.id}).then(()=>{V({message:"删除订单成功",duration:1500}),N("delete",n,e)}).catch(b=>{console.error(b)})}return(n,e)=>{const b=O("van-image"),u=O("van-button");return i(),f("div",Z,[o("div",tt,[o("div",et,[o("span",st,"订单编号："+m(t.item.orderNumber),1)]),o("div",{class:Q(["list-item-header-state",t.item.status!==-1?"text-primary-color":""])},m(t.item.statusStr),3)]),o("div",{class:"list-item-body",onClick:e[0]||(e[0]=g=>c(t.item))},[t.item.goodsInfo?(i(),f("div",ot,[h(b,{fit:"contain",class:"good-card-pic",src:t.item.goodsInfo.pic},null,8,["src"]),o("div",nt,[o("div",it,[o("div",at,m(t.item.goodsInfo.goodsName),1),t.item.goodsInfo.property?(i(),f("div",rt,m(t.item.goodsInfo.property),1)):v("",!0)]),o("div",dt,[o("div",lt,"¥"+m(p(K)(t.item.goodsInfo.amount)),1),o("div",ct,"x"+m(t.item.goodsInfo.number),1)])])])):v("",!0),t.item.goodsNumber>1?(i(),f("div",ut,"查看全部"+m(t.item.goodsNumber)+"件商品",1)):v("",!0),o("div",mt,[o("span",vt,"共"+m(t.item.goodsNumber)+"件商品",1),o("div",ft,[o("span",_t,m(t.item.status===0?"需付款：":"实付款："),1),h(W,{price:t.item.amountReal},null,8,["price"])])])]),o("div",gt,[t.item.status===-1||t.item.status===3||t.item.status===4?(i(),S(u,{key:0,class:"list-item-action-btn",round:"",onClick:e[1]||(e[1]=I(g=>k(t.item,t.index),["stop"]))},{default:l(()=>[C(" 删除订单 ")]),_:1})):v("",!0),t.item.status===0?(i(),f(D,{key:1},[h(u,{class:"list-item-action-btn",round:"",plain:"",onClick:e[2]||(e[2]=I(g=>$(t.item),["stop"]))},{default:l(()=>[C(" 取消订单 ")]),_:1}),h(u,{class:"list-item-action-btn",round:"",plain:"",type:"primary",onClick:e[3]||(e[3]=I(g=>c(t.item),["stop"]))},{default:l(()=>[C(" 去支付 ")]),_:1})],64)):v("",!0),t.item.status===1?(i(),S(u,{key:2,icon:"service",class:"list-item-action-btn",round:"",onClick:e[4]||(e[4]=I(g=>y(t.item),["stop"]))},{default:l(()=>[C(" 联系客服 ")]),_:1})):v("",!0),t.item.status===2?(i(),S(u,{key:3,class:"list-item-action-btn",round:"",onClick:e[5]||(e[5]=I(g=>c(t.item),["stop"]))},{default:l(()=>[C("确认收货")]),_:1})):v("",!0),t.item.status===3?(i(),S(u,{key:4,class:"list-item-action-btn",round:"",onClick:e[6]||(e[6]=I(g=>c(t.item),["stop"]))},{default:l(()=>[C("评价")]),_:1})):v("",!0)])])}}});const yt=B(ht,[["__scopeId","data-v-c628e5b2"]]),bt={class:"container"},pt={class:"header"},kt={action:"#",class:"search-form"},Ct={class:"list"},It={name:"OrderList"},xt=z({...It,setup(t){const N=G();H(()=>{var a;const{status:s}=N.query;s&&(r.value=p(_).findIndex(L=>L.status===s)),(a=k.value)==null||a.loadData()});const _=x([{name:"全部",status:""},{name:"待付款",status:"0"},{name:"待发货",status:"1"},{name:"待收货",status:"2"},{name:"待评价",status:"3"}]),r=x(0);function c(){var s;b.value="query",(s=k.value)==null||s.refresh()}const y=x("");function $(){var s;b.value="search",(s=k.value)==null||s.refresh()}const k=x(null),n=x([]),e=R({pageCurrent:1,pageSize:10}),b=x("query"),u=R({loadingText:"订单加载中...",emptyText:"暂无订单"});function g(s,a){n.value.splice(a,1)}function F(){const s={page:e.pageCurrent,pageSize:e.pageSize,status:p(_)[p(r)].status};return p(y)&&(s.orderNumber=p(y)),u.emptyText=p(b)==="search"?"未找到符合条件数据":"暂无订单",J.orderList(s)}function M(s){return Y((s==null?void 0:s.orderList)??[],(s==null?void 0:s.goodsMap)??[])}return(s,a)=>{const L=O("van-search"),P=O("van-tab"),q=O("van-tabs"),A=O("van-sticky"),E=U;return i(),f("div",bt,[h(A,null,{default:l(()=>[o("div",pt,[o("form",kt,[h(L,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=d=>y.value=d),class:"search-field",shape:"round","show-action":"",placeholder:"搜索订单（订单编号）",onSearch:$},{action:l(()=>[y.value?(i(),f("div",{key:0,onClick:$},"搜索")):v("",!0)]),_:1},8,["modelValue"])]),h(q,{active:r.value,"onUpdate:active":a[1]||(a[1]=d=>r.value=d),onClickTab:c},{default:l(()=>[(i(!0),f(D,null,w(_.value,(d,T)=>(i(),S(P,{key:T,title:d.name},null,8,["title"]))),128))]),_:1},8,["active"])])]),_:1}),h(E,{ref_key:"listRef",ref:k,dataSource:n.value,"onUpdate:dataSource":a[2]||(a[2]=d=>n.value=d),mode:"infinite",api:F,afterFetch:M,pagination:e,meta:u},{default:l(()=>[o("div",Ct,[(i(!0),f(D,null,w(n.value,(d,T)=>(i(),S(yt,{key:d.id,item:d,index:T,onDelete:g},null,8,["item","index"]))),128))])]),_:1},8,["dataSource","pagination","meta"])])}}});const wt=B(xt,[["__scopeId","data-v-1e113e6f"]]);export{wt as default};
