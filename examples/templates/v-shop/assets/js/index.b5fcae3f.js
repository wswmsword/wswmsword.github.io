import{r as m,b as M,c as R,t as z,_ as S,s as F}from"./index.ce6ac14e.js";import{q as H,e as x,z as v,h as O,i as c,R as B,r as p,o as w,f as I,w as g,b as i,g as y,S as W,E as j,l as C,G as J,H as K,U as L,A as Q,a as P,D as q}from"./vendor.1aafb642.js";import{i as X}from"./validate.1a81b3ef.js";function Y(e){return m({url:"/verification/mail/check",method:"post",data:e})}function Z(e){return m({url:"/verification/mail/get",method:"get",params:e})}function ee(e){return m({url:"/verification/pic/check",method:"post",data:e})}function te(e){return`${M()}/verification/pic/get?${H.stringify(e)}`}function oe(e){return m({url:"/verification/sms/check",method:"post",data:e})}function ne(e){return m({url:"/verification/sms/get",method:"get",params:e})}function se(e){return m({url:"/verification/sms/get-by-token",method:"get",params:e})}const G={verificationMailCheck:Y,verificationMailGet:Z,verificationPicCheck:ee,verificationPicGet:te,verificationSmsCheck:oe,verificationSmsGet:ne,verificationSmsGetByToken:se},ce=e=>(J("data-v-1703c5fe"),e=e(),K(),e),ae={class:"captcha-container"},ie=ce(()=>i("div",{class:"captcha-header van-hairline--bottom"},"请完成安全验证",-1)),re={class:"captcha-body"},le={class:"captcha-code"},ue=["src"],pe={class:"captcha-footer"},de={name:"Captcha"},_e=x({...de,props:{show:{type:Boolean,default:!1}},emits:["confirm","update:show"],setup(e,{expose:t,emit:n}){const a=e,o={width:"80%","border-radius":"4px"},f=v(""),d=v(""),s=v(""),_=R(150),r=O(()=>c(s).length);function l(){h()}const h=z(()=>{const u=`${Date.now()}`;f.value=u,s.value="",d.value=G.verificationPicGet({key:u})},3e3);function k(){if(!c(s)){C("请输入图形验证码");return}n("confirm",{requestId:c(f),code:c(s)})}B(()=>a.show,u=>{u&&l()});function V(){b(!0)}function $(){b(!1)}function b(u){n("update:show",u)}return t({open:V,close:$,updateShow:b}),(u,T)=>{const N=p("van-icon"),U=p("van-field"),A=p("van-button"),D=p("van-popup");return w(),I(D,{show:e.show,position:"center",teleport:"body",style:o,"onUpdate:show":b},{default:g(()=>[i("div",{class:"captcha-popup-close",onClick:$},[y(N,{class:"captcha-popup-close-icon",name:"cross"})]),i("div",ae,[ie,i("div",re,[i("div",le,[y(U,{modelValue:s.value,"onUpdate:modelValue":T[0]||(T[0]=E=>s.value=E),clearable:"",border:!1,placeholder:"输入验证码",class:"captcha-field",type:"text",focus:""},null,8,["modelValue"]),i("img",{class:"captcha-img",style:W([{width:c(_)+"px",background:"#eee"}]),src:d.value,onClick:l},null,12,ue)]),i("div",{class:"tips",onClick:l},"看不清，换一张"),i("div",pe,[y(A,{class:"captcha-btn",block:"",disabled:!r.value,type:"primary",onClick:k},{default:g(()=>[j(" 确认发送 ")]),_:1},8,["disabled"])])])])]),_:1},8,["show"])}}});const me=S(_e,[["__scopeId","data-v-1703c5fe"]]);function fe(){let e=null;const t=v(0);function n(o=0){t.value=o,e=setInterval(()=>{console.log(t.value),t.value>0?t.value--:a()},1e3)}function a(){e&&(clearTimeout(e),e=null)}return L(()=>{a()}),{count:t,start:n,stop:a}}const he={key:0,class:"sms-btn countdown"},ve=x({__name:"index",props:{mobile:[String,Number]},setup(e){const t=e,{count:n,start:a}=fe(),o=Q({smsText:"获取验证码",captchaShow:!1});function f(){if(!c(t.mobile)){C("请输入手机号");return}if(!X(c(String(t.mobile)))){C("手机号格式错误");return}o.captchaShow=!0}function d(_){s({picCodeParams:_})}function s(_={}){const{picCodeParams:r}=_,l={mobile:c(t.mobile),key:r.requestId,picCode:r.code};G.verificationSmsGet(l).then(()=>{o.captchaShow=!1,C({message:"短信已发送，请查收",duration:2e3}),a(F.count)}).catch(h=>{console.error(h)})}return B(n,()=>{n.value>0?o.smsText=`已发送(${n.value}s)`:o.smsText="重新发送"}),(_,r)=>{const l=me,h=p("van-field");return w(),I(h,null,{button:g(()=>[c(n)?(w(),P("span",he,q(o.smsText),1)):(w(),P("span",{key:1,class:"sms-btn",onClick:f},q(o.smsText),1)),y(l,{show:o.captchaShow,"onUpdate:show":r[0]||(r[0]=k=>o.captchaShow=k),onConfirm:d},null,8,["show"])]),_:1})}}});const ke=S(ve,[["__scopeId","data-v-181ded48"]]),we=x({name:"PwdField",setup(){const e=v(!1);function t(){e.value=!e.value}return{eye:e,onSwitch:t}}});function ye(e,t,n,a,o,f){const d=p("van-icon"),s=p("van-field");return w(),I(s,{type:e.eye?"text":"password"},{"right-icon":g(()=>[y(d,{name:e.eye?"eye-o":"closed-eye",onClick:e.onSwitch},null,8,["name","onClick"])]),_:1},8,["type"])}const Se=S(we,[["render",ye]]);export{Se as _,ke as a};
