import{_ as D}from"./index.6012130b.js";import{A as S,j as _,Z as $,_ as C,i as M,e as w,h as L,o as k,f as A,w as E,$ as R}from"./vendor.1aafb642.js";import{_ as v}from"./index.ce6ac14e.js";function y(e={},r,a){const{immediate:u=!1,fieldNames:l={itemsField:"items",totalRowField:"total"},meta:f={},other:d}=e,o=S({loading:!0,hasData:!1,loadingMore:!1,noMore:!1,error:!1,immediate:u,meta:f,...d});function m(){a&&(a.pageCurrent=1),o.loading=!0,r.value=[],n()}function c(){o.error=!1,n()}function g(){o.noMore||(a&&(a.pageCurrent+=1),n())}function n(){if(!e.api)return;const s=!a||(a==null?void 0:a.pageCurrent)===1;return e.api().then(t=>{var h,F;let i=((h=t.data)==null?void 0:h[l.itemsField])??[];const p=((F=t.data)==null?void 0:F[l.totalRowField])??0;e.afterFetch&&(i=e.afterFetch(t.data)),s?(r.value=i,C(()=>{o.loading=!1,o.hasData=!!M(r).length})):(r.value=M(r).concat(i),C(()=>{o.loadingMore=!1,o.noMore=M(r).length>=p}))}).catch(t=>{console.error(t),s?o.loading=!1:o.loadingMore=!1,o.error=!0})}return _(()=>{o.immediate&&n()}),{...$(o),refresh:m,onError:c,loadMore:g,loadData:n}}const j=w({name:"ProList",components:{AppList:D},inheritAttrs:!1,props:{dataSource:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({pageCurrent:1,pageSize:20})},fieldNames:{type:Object,default:()=>({itemsField:"result",totalRowField:"totalRow"})},mode:String,immediate:Boolean},emits:["update:dataSource"],setup(e,{attrs:r,emit:a,expose:u}){const l=L({get(){return e.dataSource},set(p){a("update:dataSource",p)}}),{loading:f,hasData:d,loadingMore:o,noMore:m,error:c,meta:g,refresh:n,onError:s,loadMore:t,loadData:i}=y({...r,...e},l,e.pagination);return u({refresh:n,onError:s,loadMore:t,loadData:i}),{loading:f,hasData:d,loadingMore:o,noMore:m,error:c,meta:g,loadMore:t,onError:s}}});function B(e,r,a,u,l,f){const d=D;return k(),A(d,{loading:e.loading,"onUpdate:loading":r[0]||(r[0]=o=>e.loading=o),loadingMore:e.loadingMore,"onUpdate:loadingMore":r[1]||(r[1]=o=>e.loadingMore=o),mode:e.mode,error:e.error,hasData:e.hasData,noMore:e.noMore,meta:e.meta,onLoadMore:e.loadMore,onClickError:e.onError},{default:E(()=>[R(e.$slots,"default")]),_:3},8,["loading","loadingMore","mode","error","hasData","noMore","meta","onLoadMore","onClickError"])}const P=v(j,[["render",B]]);export{P as _};
