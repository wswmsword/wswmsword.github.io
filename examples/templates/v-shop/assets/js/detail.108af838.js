import{p as ce,d as ve}from"./format.df5cff0c.js";import{e as j,h as x,i as t,r as h,o as d,f as E,w as N,a as _,g as p,b as e,D as r,E as U,C as L,B as M,F as z,V as he,l as D,G as Q,H as X,j as Y,z as y,K as ke,k as ne,u as ge,y as fe,I as ye}from"./vendor.1aafb642.js";import{_ as q,d as be}from"./index.ce6ac14e.js";import{_ as $e}from"./index.9f946532.js";import{g as Ce}from"./afterSale.eaafb7e8.js";import{A as le}from"./index.9c8d6691.js";import{A as ie}from"./index.ed12fca4.js";import{A as ae}from"./index.ccd2f348.js";import{g as Se}from"./reputation.a195e891.js";import{u as Ie}from"./order.1a54acc5.js";import{u as Le}from"./usePage.0ebad3d8.js";import"./is.697638d0.js";import"./index.4d464653.js";import"./index.a51135f2.js";const de=a=>(Q("data-v-17b3cfee"),a=a(),X(),a),we={key:0,class:"sku-header van-hairline--bottom"},Pe={class:"sku-header-good-info"},xe={class:"sku-header-good-name van-multi-ellipsis--l2"},Ne={class:"sku-header-good-info-bd"},Te={class:"sku-header-good-price"},De=de(()=>e("span",{class:"sku-header-good-price-symbol"},"¥",-1)),Ve={class:"sku-header-good-price-integer"},Ae={class:"sku-header-item"},Ee={class:"sku-header-good-stock-num"},Ge={key:0,class:"sku-header-item"},Re={class:"sku-body"},Oe={class:"sku-group-hd"},Be={key:0,class:"sku-group-list"},Ue=["onClick"],Me={class:"sku-group-list-item-name"},ze={class:"sku-num"},Fe=de(()=>e("div",{class:"sku-num-title"},"购买数量",-1)),He={class:"sku-actions"},je={name:"Sku"},qe=j({...je,props:{show:{type:Boolean,default:!1},sku:{type:Object,default:()=>({})},initialSku:{type:Object,default:()=>({})}},emits:["update:show","confirm"],setup(a,{expose:V,emit:C}){const o=a,A={display:"flex","flex-direction":"column","align-items":"stretch","max-height":"80%","min-height":"50%","overflow-y":"visible","font-size":"14px"},b=x(()=>!!o.sku.skuList.length),s=x(()=>{if(t(b)){const{skuList:n}=o.sku;let l="";return Object.keys(o.initialSku.selectedProps).forEach(c=>{l+=`${c}:${o.initialSku.selectedProps[c]},`}),n.find(c=>c.propertyChildIds===l)}}),$=x(()=>{if(t(b)){const{propList:n}=o.sku,{selectedPropList:l}=o.initialSku;return t(s)?`已选 ${l.reduce((c,m)=>`${c} ${m.childName}`,"")}`:`请选择 ${n.reduce((c,m)=>`${c}${l.some(T=>T.id===m.id)?"":m.name}`,"")}`}else return""}),v=x(()=>{var n,l,c;if(t(b)){if(t(s))return{price:(n=t(s))==null?void 0:n.price,maxPrice:(l=t(s))==null?void 0:l.price,stock:(c=t(s))==null?void 0:c.stores};{const{skuList:m}=o.sku;return{price:m[0].price,maxPrice:m[m.length-1].price,stock:o.sku.stock}}}else return{price:o.sku.price,maxPrice:o.sku.price,stock:o.sku.stock}});function k(n,l){const c=o.sku.propList[n],m=c.childsCurGoods[l];o.initialSku.selectedProps[c.id]=o.initialSku.selectedProps[c.id]===m.id?0:m.id;const T=[];o.sku.propList.forEach(I=>{I.childsCurGoods.forEach(f=>{o.initialSku.selectedProps[I.id]===f.id&&T.push({id:I.id,name:I.name,childId:f.id,childName:f.name,propIds:`${I.id}:${f.id}`})})}),o.initialSku.selectedPropList=T}function g(){if(o.initialSku.selectedNum>t(v).stock){D({message:"库存不足",duration:1500});return}if(t(b)&&!t(s)){D({message:"请选择商品规格",duration:1500});return}const n={goodsId:o.sku.goodInfo.id,selectedSkuComb:t(v)};C("confirm",n)}function w(){P(!1)}function S(){P(!0)}function P(n){C("update:show",n)}return V({open:S,close:w,updateShow:P}),(n,l)=>{const c=h("van-image"),m=h("van-stepper"),T=h("van-button"),I=h("van-popup");return d(),E(I,{show:a.show,round:"",closeable:"",position:"bottom",style:A,"onUpdate:show":P},{default:N(()=>[a.sku.goodInfo?(d(),_("div",we,[p(c,{class:"sku-header-pic",src:a.sku.goodInfo.pic,fit:"cover"},null,8,["src"]),e("div",Pe,[e("div",xe,r(a.sku.goodInfo.name),1),e("div",Ne,[e("div",Te,[De,e("span",Ve,r(t(ce)(v.value.price,v.value.maxPrice)),1)]),e("div",Ae,[U(" 剩余 "),e("span",Ee,r(v.value.stock),1),U(" "+r(a.sku.goodInfo.unit||"件"),1)]),$.value?(d(),_("div",Ge,r($.value),1)):L("",!0)])])])):L("",!0),e("div",Re,[(d(!0),_(z,null,M(a.sku.propList,(f,J)=>(d(),_("div",{key:f.id,class:"sku-group van-hairline--bottom"},[e("div",Oe,r(f.name),1),f.childsCurGoods&&f.childsCurGoods.length?(d(),_("div",Be,[(d(!0),_(z,null,M(f.childsCurGoods,(O,H)=>(d(),_("div",{key:O.id,class:he(["sku-group-list-item",a.initialSku.selectedProps[f.id]===O.id?"active":""]),onClick:Z=>k(J,H)},[e("span",Me,r(O.name),1)],10,Ue))),128))])):L("",!0)]))),128)),e("div",ze,[Fe,p(m,{modelValue:a.initialSku.selectedNum,"onUpdate:modelValue":l[0]||(l[0]=f=>a.initialSku.selectedNum=f),class:"sku-num-stepper"},null,8,["modelValue"])])]),e("div",He,[p(T,{type:"primary",round:"",block:"",onClick:g},{default:N(()=>[U("确定")]),_:1})])]),_:1},8,["show"])}}});const Je=q(qe,[["__scopeId","data-v-17b3cfee"]]),re=a=>(Q("data-v-5d4c85e1"),a=a(),X(),a),Ke={class:"coupons"},We=re(()=>e("div",{class:"coupons-header van-hairline--bottom"},"优惠券",-1)),Qe={class:"coupons-body"},Xe={class:"coupon-list"},Ye={class:"coupon-list-item-hd"},Ze={class:"coupon-list-item-money"},et=re(()=>e("span",{class:"fz12"},"¥",-1)),tt={class:"coupon-list-item-moneyHreshold"},st={class:"coupon-list-item-bd"},ot={class:"coupon-list-item-name"},nt={key:0,class:"coupon-list-item-dateEndDays"},it={key:1,class:"coupon-list-item-dateEndDays"},at=["onClick"],ct=j({__name:"Coupons",props:{title:{type:String}},setup(a,{expose:V}){Y(()=>{A()});const C=y(!1),o=y([]);function A(){ae.discountsCoupons({type:"NO_PWD"}).then(k=>{k.data&&(o.value=k.data)})}function b(k){const g=t(o)[k];ke({forbidClick:!0,message:"加载中...",duration:0});const w={id:g.id};ae.discountsFetch(w).then(()=>{ne(),D({message:"恭喜,抢到了~",duration:2e3})}).catch(S=>{console.error(S),ne(),Number(S.code)===700?D({message:"很遗憾,没抢到~",duration:2e3}):D({message:S.msg,duration:2e3})})}function s(){v(!1)}function $(){v(!0)}function v(k){C.value=k}return V({open:$,close:s,toggle:v}),(k,g)=>{const w=h("van-cell"),S=h("van-button"),P=h("van-popup");return d(),_("div",Ke,[o.value.length?(d(),E(w,{key:0,class:"mb10",title:a.title,"is-link":"",onClick:$},null,8,["title"])):L("",!0),p(P,{show:C.value,"onUpdate:show":g[0]||(g[0]=n=>C.value=n),round:"",closeable:"",position:"bottom"},{default:N(()=>[We,e("div",Qe,[e("div",Xe,[(d(!0),_(z,null,M(o.value,(n,l)=>(d(),_("div",{key:n.id,class:"coupon-list-item"},[e("div",Ye,[e("div",Ze,[et,U(r(n.moneyMin),1)]),e("div",tt,"满"+r(n.moneyHreshold)+"元可用",1)]),e("div",st,[e("div",ot,r(n.moneyMin)+"元券",1),n.dateEndType===0?(d(),_("div",nt," 领取后 "+r(n.dateEnd.slice(0,10))+" 到期 ",1)):L("",!0),n.dateEndType===1?(d(),_("div",it," 领取后 "+r(n.dateEndDays)+" 天后到期 ",1)):L("",!0)]),e("div",{class:"coupon-list-item-btn",onClick:c=>b(l)},"立即领取",8,at)]))),128))])]),e("div",{class:"coupons-footer",onClick:s},[p(S,{type:"primary",round:"",block:"",onClick:s},{default:N(()=>[U("完成")]),_:1})])]),_:1},8,["show"])])}}});const lt=q(ct,[["__scopeId","data-v-5d4c85e1"]]),dt={class:"reputation"},rt={class:"reputation-inner-hd"},ut={class:"reputation-inner-name"},pt={class:"reputation-inner-stars"},_t={class:"reputation-inner-ft"},mt={class:"reputation-inner-prop"},vt=j({__name:"Reputations",props:{goodsId:{type:[String,Number]}},setup(a){const V=a;Y(()=>{A()});const C=y([]),o=y(0);function A(){le.goodsReputation({goodsId:V.goodsId,page:1,pageSize:1}).then(b=>{var v,k;const s=((v=b.data)==null?void 0:v.result)??[],$=((k=b.data)==null?void 0:k.totalRow)??0;s.length&&(o.value=$,C.value=Se(s))})}return(b,s)=>{const $=h("van-cell"),v=h("van-image"),k=h("van-rate");return d(),_("div",dt,[C.value.length?(d(),E($,{key:0,to:"/good/reputation?goodsId="+a.goodsId,class:"mb10",title:"评价("+o.value+")",value:"全部评价","is-link":""},null,8,["to","title"])):(d(),E($,{key:1,class:"mb10",title:"商品评价",value:"暂无评价"})),(d(!0),_(z,null,M(C.value,(g,w)=>(d(),_("div",{key:w,class:"reputation-inner"},[e("div",rt,[p(v,{class:"reputation-inner-media",src:g.avatarUrl},null,8,["src"]),e("div",ut,r(g.nickName),1),e("div",pt,[p(k,{modelValue:g.rate,"onUpdate:modelValue":S=>g.rate=S,size:14,color:"#f44","void-icon":"star","void-color":"#eee",readonly:""},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",_t,[e("div",null,r(g.remark),1),e("div",mt,r(g.property),1)])]))),128))])}}});const ht=q(vt,[["__scopeId","data-v-109322da"]]),F=a=>(Q("data-v-a9912a9d"),a=a(),X(),a),kt={class:"container"},gt={class:"section"},ft={class:"price"},yt={class:"price-hd"},bt={class:"price-current"},$t=F(()=>e("span",{class:"price-current-symbol"},"¥",-1)),Ct={class:"price-current-integer"},St={key:0,class:"price-origin"},It=F(()=>e("span",{class:"price-origin-label"},"价格",-1)),Lt=F(()=>e("span",{class:"price-origin-symbol"},"¥",-1)),wt={class:"price-origin-integer"},Pt={class:"desc"},xt={class:"desc-hd"},Nt={class:"desc-title van-multi-ellipsis--l2"},Tt={key:0,class:"desc-brief"},Dt={class:"stock van-hairline--top"},Vt={class:"stock-item"},At={class:"stock-item"},Et={class:"cell-bar"},Gt=F(()=>e("div",{class:"cell-bar-title"},"服务",-1)),Rt={class:"cell-bar-text"},Ot={class:"cell-bar"},Bt={class:"cell-bar-title"},Ut={class:"cell-bar-text"},Mt=["innerHTML"],zt=F(()=>e("div",{class:"action-bar-perch"},null,-1)),Ft={name:"GoodDetail"},Ht=j({...Ft,setup(a){Y(()=>{S(),t(A)&&te()});const V=ge(),C=fe(),o=Ie(),{hasLogin:A}=Le(),b=y([]),s=y({}),$=y({}),v=y(""),k=x(()=>t(m)?t(l).skuList[0].price:t(s).minPrice),g=x(()=>t(m)?t(l).skuList[t(l).skuList.length-1].price:""),w=x(()=>t(s).logisticsId?`运费 ${t($).isFree?"包邮":"不包邮"}`:"无需配送");function S(){le.goodsDetail({id:V.query.id}).then(i=>{var u,G,R;if(b.value=i.data.pics,s.value=i.data.basicInfo,$.value=((u=i.data)==null?void 0:u.logistics)??{},v.value=i.data.content,t(s).status===1){D(t(s).statusStr);return}if(t(s).stores===0){ye({title:"提示",message:"该商品已售罄,去看看其他商品吧！",showCancelButton:!1}).then(()=>{C.replace({path:"/home"})}).catch(()=>{});return}document.title=t(s).name,J(i.data.basicInfo,((G=i.data)==null?void 0:G.properties)??[],((R=i.data)==null?void 0:R.skuList)??[]),Z()})}const P=y("goBuy"),n=y(!1),l=y({goodsId:0,price:0,stock:0,goodInfo:{},propList:[],skuList:[]}),c=y({selectedNum:1,selectedProps:{},selectedPropList:[]}),m=x(()=>!!t(l).skuList.length),T=x(()=>t(m)?t(c).selectedPropList.length?t(c).selectedPropList.reduce((i,u)=>`${i} ${u.childName}`,""):t(l).propList.reduce((i,u)=>`${i} ${u.name}`,""):"");function I(i){P.value=i,n.value=!0}const f=be(i=>{n.value=!1,t(P)==="addCart"?ue():o.setTradeGoods({origin:"buy",list:[{goodsId:t(l).goodsId,name:t(l).goodInfo.name,number:t(c).selectedNum,pic:t(l).goodInfo.pic,price:i.selectedSkuComb.price,logisticsId:t(s).logisticsId,propertyList:t(c).selectedPropList}]})},1500);function J(i,u,G){l.value={goodsId:i.id,stock:i.stores,price:i.minPrice,goodInfo:{id:i.id,pic:i.pic,name:i.name,unit:i.unit},propList:u,skuList:G.sort((R,K)=>R.price-K.price)}}function O(){D("未开放：客服")}const H=y("");function Z(){H.value=Ce(t(s).afterSale)}const ee=y(void 0);function te(){ie.shoppingCartInfo().then(i=>{var u;ee.value=(u=i.data)==null?void 0:u.number})}function ue(){const i={goodsId:t(l).goodsId,number:t(c).selectedNum};t(c).selectedPropList.length&&(i.sku=JSON.stringify(t(c).selectedPropList.map(u=>({optionId:u.id,optionValueId:u.childId})))),ie.shoppingCartAdd(i).then(()=>{D("已成功加入购物车"),te()}).catch(u=>{console.error(u)})}return(i,u)=>{const G=h("van-image"),R=h("van-swipe-item"),K=h("van-swipe"),se=h("van-cell"),pe=$e,W=h("van-action-bar-icon"),oe=h("van-action-bar-button"),_e=h("van-action-bar"),me=Je;return d(),_("div",kt,[p(K,{autoplay:3e3,class:"swiper"},{default:N(()=>[(d(!0),_(z,null,M(b.value,B=>(d(),E(R,{key:B.id,class:"swiper-item"},{default:N(()=>[p(G,{class:"swiper-item-img",fit:"contain",src:B.pic,alt:""},null,8,["src"])]),_:2},1024))),128))]),_:1}),e("div",gt,[e("div",ft,[e("div",yt,[e("div",bt,[$t,e("span",Ct,r(t(ce)(k.value,g.value)),1)]),s.value.originalPrice>0?(d(),_("div",St,[It,Lt,e("span",wt,r(t(ve)(s.value.originalPrice)),1)])):L("",!0)])]),e("div",Pt,[e("div",xt,[e("div",Nt,r(s.value.name),1),s.value.characteristic?(d(),_("div",Tt,r(s.value.characteristic),1)):L("",!0)])])]),e("div",Dt,[e("div",Vt,r(w.value),1),e("div",At,"剩余 "+r(s.value.stores),1)]),p(lt,{title:"领券"}),p(se,null,{title:N(()=>[e("div",Et,[Gt,e("div",Rt,r(H.value),1)])]),_:1}),m.value?(d(),E(se,{key:0,border:!1,"is-link":"",onClick:I},{title:N(()=>[e("div",Ot,[e("div",Bt,r(c.value.selectedPropList.length?"已选":"选择"),1),e("div",Ut,r(T.value),1)])]),_:1})):L("",!0),s.value.id?(d(),E(ht,{key:1,class:"mt10","goods-id":s.value.id},null,8,["goods-id"])):L("",!0),p(pe,{title:"商品详情",class:"mt10"}),e("div",{class:"goods-content",innerHTML:v.value},null,8,Mt),zt,p(_e,null,{default:N(()=>[p(W,{icon:"thumb-circle-o",text:"首页",to:"/home",replace:""}),p(W,{icon:"chat-o",text:"客服",onClick:O}),p(W,{icon:"cart-o",text:"购物车",to:"/cart",badge:ee.value,replace:""},null,8,["badge"]),p(oe,{type:"warning",text:"加入购物车",onClick:u[0]||(u[0]=B=>I("addCart"))}),p(oe,{type:"danger",text:"立即购买",onClick:I})]),_:1}),p(me,{show:n.value,"onUpdate:show":u[1]||(u[1]=B=>n.value=B),sku:l.value,"initial-sku":c.value,onConfirm:t(f)},null,8,["show","sku","initial-sku","onConfirm"])])}}});const is=q(Ht,[["__scopeId","data-v-a9912a9d"]]);export{is as default};
